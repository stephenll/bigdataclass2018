<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>10 Text mining with sparklyr | _main.utf8.md</title>
  <meta name="description" content="">
  <meta name="generator" content="bookdown  and GitBook 2.6.7">

  <meta property="og:title" content="10 Text mining with sparklyr | _main.utf8.md" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="10 Text mining with sparklyr | _main.utf8.md" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="intro-to-dashboards.html">

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Big Data with R - Exercise book</a></li>
<li class="chapter" data-level="1" data-path="access-a-database.html"><a href="access-a-database.html"><i class="fa fa-check"></i><b>1</b> Access a database</a><ul>
<li class="chapter" data-level="1.1" data-path="access-a-database.html"><a href="access-a-database.html#connect-to-a-database"><i class="fa fa-check"></i><b>1.1</b> Connect to a database</a></li>
<li class="chapter" data-level="1.2" data-path="access-a-database.html"><a href="access-a-database.html#explore-the-database-using-the-rstudio-ide"><i class="fa fa-check"></i><b>1.2</b> Explore the database using the RStudio IDE</a></li>
<li class="chapter" data-level="1.3" data-path="access-a-database.html"><a href="access-a-database.html#list-drivers-and-dsns"><i class="fa fa-check"></i><b>1.3</b> List drivers and DSNs</a></li>
<li class="chapter" data-level="1.4" data-path="access-a-database.html"><a href="access-a-database.html#connect-to-a-database-using-code"><i class="fa fa-check"></i><b>1.4</b> Connect to a database using code</a></li>
<li class="chapter" data-level="1.5" data-path="access-a-database.html"><a href="access-a-database.html#rstudio-sql-script"><i class="fa fa-check"></i><b>1.5</b> RStudio SQL Script</a></li>
<li class="chapter" data-level="1.6" data-path="access-a-database.html"><a href="access-a-database.html#connect-to-a-database-without-a-dsn"><i class="fa fa-check"></i><b>1.6</b> Connect to a database without a DSN</a></li>
<li class="chapter" data-level="1.7" data-path="access-a-database.html"><a href="access-a-database.html#secure-credentials-in-a-file"><i class="fa fa-check"></i><b>1.7</b> Secure credentials in a file</a></li>
<li class="chapter" data-level="1.8" data-path="access-a-database.html"><a href="access-a-database.html#environment-variables"><i class="fa fa-check"></i><b>1.8</b> Environment variables</a></li>
<li class="chapter" data-level="1.9" data-path="access-a-database.html"><a href="access-a-database.html#use-options"><i class="fa fa-check"></i><b>1.9</b> Use options()</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="dplyr-basics.html"><a href="dplyr-basics.html"><i class="fa fa-check"></i><b>2</b> <code>dplyr</code> Basics</a><ul>
<li class="chapter" data-level="2.1" data-path="dplyr-basics.html"><a href="dplyr-basics.html#create-a-table-variable"><i class="fa fa-check"></i><b>2.1</b> Create a table variable</a></li>
<li class="chapter" data-level="2.2" data-path="dplyr-basics.html"><a href="dplyr-basics.html#under-the-hood"><i class="fa fa-check"></i><b>2.2</b> Under the hood</a></li>
<li class="chapter" data-level="2.3" data-path="dplyr-basics.html"><a href="dplyr-basics.html#un-translated-r-commands"><i class="fa fa-check"></i><b>2.3</b> Un-translated R commands</a></li>
<li class="chapter" data-level="2.4" data-path="dplyr-basics.html"><a href="dplyr-basics.html#using-bang-bang"><i class="fa fa-check"></i><b>2.4</b> Using bang-bang</a></li>
<li class="chapter" data-level="2.5" data-path="dplyr-basics.html"><a href="dplyr-basics.html#knitr-sql-engine"><i class="fa fa-check"></i><b>2.5</b> knitr SQL engine</a></li>
<li class="chapter" data-level="2.6" data-path="dplyr-basics.html"><a href="dplyr-basics.html#basic-aggregation"><i class="fa fa-check"></i><b>2.6</b> Basic aggregation</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="data-transformation.html"><a href="data-transformation.html"><i class="fa fa-check"></i><b>3</b> Data transformation</a><ul>
<li class="chapter" data-level="3.1" data-path="data-transformation.html"><a href="data-transformation.html#group-and-sort-records"><i class="fa fa-check"></i><b>3.1</b> Group and sort records</a></li>
<li class="chapter" data-level="3.2" data-path="data-transformation.html"><a href="data-transformation.html#answering-questions-with-dplyr"><i class="fa fa-check"></i><b>3.2</b> Answering questions with <code>dplyr</code></a></li>
<li class="chapter" data-level="3.3" data-path="data-transformation.html"><a href="data-transformation.html#aggregate-mulitple-columns"><i class="fa fa-check"></i><b>3.3</b> Aggregate mulitple columns</a></li>
<li class="chapter" data-level="3.4" data-path="data-transformation.html"><a href="data-transformation.html#data-correlation"><i class="fa fa-check"></i><b>3.4</b> Data correlation</a></li>
<li class="chapter" data-level="3.5" data-path="data-transformation.html"><a href="data-transformation.html#view-record-level-data"><i class="fa fa-check"></i><b>3.5</b> View record level data</a></li>
<li class="chapter" data-level="3.6" data-path="data-transformation.html"><a href="data-transformation.html#case-statements"><i class="fa fa-check"></i><b>3.6</b> Case statements</a></li>
<li class="chapter" data-level="3.7" data-path="data-transformation.html"><a href="data-transformation.html#data-enrichment"><i class="fa fa-check"></i><b>3.7</b> Data enrichment</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="data-visualizations.html"><a href="data-visualizations.html"><i class="fa fa-check"></i><b>4</b> Data Visualizations</a><ul>
<li class="chapter" data-level="4.1" data-path="data-visualizations.html"><a href="data-visualizations.html#simple-plot"><i class="fa fa-check"></i><b>4.1</b> Simple plot</a></li>
<li class="chapter" data-level="4.2" data-path="data-visualizations.html"><a href="data-visualizations.html#plot-in-one-code-segment"><i class="fa fa-check"></i><b>4.2</b> Plot in one code segment</a></li>
<li class="chapter" data-level="4.3" data-path="data-visualizations.html"><a href="data-visualizations.html#plot-specific-data-segments"><i class="fa fa-check"></i><b>4.3</b> Plot specific data segments</a></li>
<li class="chapter" data-level="4.4" data-path="data-visualizations.html"><a href="data-visualizations.html#plot-correlations"><i class="fa fa-check"></i><b>4.4</b> Plot correlations</a></li>
<li class="chapter" data-level="4.5" data-path="data-visualizations.html"><a href="data-visualizations.html#two-or-more-queries"><i class="fa fa-check"></i><b>4.5</b> Two or more queries</a></li>
<li class="chapter" data-level="4.6" data-path="data-visualizations.html"><a href="data-visualizations.html#visualize-using-dbplot"><i class="fa fa-check"></i><b>4.6</b> Visualize using <code>dbplot</code></a></li>
<li class="chapter" data-level="4.7" data-path="data-visualizations.html"><a href="data-visualizations.html#plot-a-different-aggregation"><i class="fa fa-check"></i><b>4.7</b> Plot a different aggregation</a></li>
<li class="chapter" data-level="4.8" data-path="data-visualizations.html"><a href="data-visualizations.html#create-a-histogram"><i class="fa fa-check"></i><b>4.8</b> Create a histogram</a></li>
<li class="chapter" data-level="4.9" data-path="data-visualizations.html"><a href="data-visualizations.html#raster-plot"><i class="fa fa-check"></i><b>4.9</b> Raster plot</a></li>
<li class="chapter" data-level="4.10" data-path="data-visualizations.html"><a href="data-visualizations.html#using-the-calculate-functions"><i class="fa fa-check"></i><b>4.10</b> Using the <code>calculate</code> functions</a></li>
<li class="chapter" data-level="4.11" data-path="data-visualizations.html"><a href="data-visualizations.html#under-the-hood-ii"><i class="fa fa-check"></i><b>4.11</b> Under the hood (II)</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="modeling.html"><a href="modeling.html"><i class="fa fa-check"></i><b>5</b> Modeling</a><ul>
<li class="chapter" data-level="5.1" data-path="modeling.html"><a href="modeling.html#sql-native-sampling"><i class="fa fa-check"></i><b>5.1</b> SQL Native sampling</a></li>
<li class="chapter" data-level="5.2" data-path="modeling.html"><a href="modeling.html#sample-with-id"><i class="fa fa-check"></i><b>5.2</b> Sample with ID</a></li>
<li class="chapter" data-level="5.3" data-path="modeling.html"><a href="modeling.html#sample-manually"><i class="fa fa-check"></i><b>5.3</b> Sample manually</a></li>
<li class="chapter" data-level="5.4" data-path="modeling.html"><a href="modeling.html#create-a-model-test"><i class="fa fa-check"></i><b>5.4</b> Create a model &amp; test</a></li>
<li class="chapter" data-level="5.5" data-path="modeling.html"><a href="modeling.html#score-inside-database"><i class="fa fa-check"></i><b>5.5</b> Score inside database</a></li>
<li class="chapter" data-level="5.6" data-path="modeling.html"><a href="modeling.html#parsed-model"><i class="fa fa-check"></i><b>5.6</b> Parsed model</a></li>
<li class="chapter" data-level="5.7" data-path="modeling.html"><a href="modeling.html#model-inside-the-database"><i class="fa fa-check"></i><b>5.7</b> Model inside the database</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="advanced-operations.html"><a href="advanced-operations.html"><i class="fa fa-check"></i><b>6</b> Advanced operations</a><ul>
<li class="chapter" data-level="6.1" data-path="advanced-operations.html"><a href="advanced-operations.html#simple-wrapper-function"><i class="fa fa-check"></i><b>6.1</b> Simple wrapper function</a></li>
<li class="chapter" data-level="6.2" data-path="advanced-operations.html"><a href="advanced-operations.html#multiple-variables"><i class="fa fa-check"></i><b>6.2</b> Multiple variables</a></li>
<li class="chapter" data-level="6.3" data-path="advanced-operations.html"><a href="advanced-operations.html#multiple-queries"><i class="fa fa-check"></i><b>6.3</b> Multiple queries</a></li>
<li class="chapter" data-level="6.4" data-path="advanced-operations.html"><a href="advanced-operations.html#multiple-queries-with-an-overlaping-range"><i class="fa fa-check"></i><b>6.4</b> Multiple queries with an overlaping range</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="intro-to-sparklyr.html"><a href="intro-to-sparklyr.html"><i class="fa fa-check"></i><b>7</b> Intro to <code>sparklyr</code></a><ul>
<li class="chapter" data-level="7.1" data-path="intro-to-sparklyr.html"><a href="intro-to-sparklyr.html#new-spark-session"><i class="fa fa-check"></i><b>7.1</b> New Spark session</a></li>
<li class="chapter" data-level="7.2" data-path="intro-to-sparklyr.html"><a href="intro-to-sparklyr.html#data-transfer"><i class="fa fa-check"></i><b>7.2</b> Data transfer</a></li>
<li class="chapter" data-level="7.3" data-path="intro-to-sparklyr.html"><a href="intro-to-sparklyr.html#simple-dplyr-example"><i class="fa fa-check"></i><b>7.3</b> Simple dplyr example</a></li>
<li class="chapter" data-level="7.4" data-path="intro-to-sparklyr.html"><a href="intro-to-sparklyr.html#map-data"><i class="fa fa-check"></i><b>7.4</b> Map data</a></li>
<li class="chapter" data-level="7.5" data-path="intro-to-sparklyr.html"><a href="intro-to-sparklyr.html#caching-data"><i class="fa fa-check"></i><b>7.5</b> Caching data</a></li>
<li class="chapter" data-level="7.6" data-path="intro-to-sparklyr.html"><a href="intro-to-sparklyr.html#sdf-functions"><i class="fa fa-check"></i><b>7.6</b> <code>sdf</code> Functions</a></li>
<li class="chapter" data-level="7.7" data-path="intro-to-sparklyr.html"><a href="intro-to-sparklyr.html#feature-transformers"><i class="fa fa-check"></i><b>7.7</b> Feature transformers</a></li>
<li class="chapter" data-level="7.8" data-path="intro-to-sparklyr.html"><a href="intro-to-sparklyr.html#fit-a-model-with-sparklyr"><i class="fa fa-check"></i><b>7.8</b> Fit a model with <code>sparklyr</code></a></li>
<li class="chapter" data-level="7.9" data-path="intro-to-sparklyr.html"><a href="intro-to-sparklyr.html#run-predictions-in-spark"><i class="fa fa-check"></i><b>7.9</b> Run predictions in Spark</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="spark-pipelines.html"><a href="spark-pipelines.html"><i class="fa fa-check"></i><b>8</b> Spark pipelines</a><ul>
<li class="chapter" data-level="8.1" data-path="spark-pipelines.html"><a href="spark-pipelines.html#build-a-pipeline"><i class="fa fa-check"></i><b>8.1</b> Build a pipeline</a></li>
<li class="chapter" data-level="8.2" data-path="spark-pipelines.html"><a href="spark-pipelines.html#fit-evaluate-save"><i class="fa fa-check"></i><b>8.2</b> Fit, evaluate, save</a></li>
<li class="chapter" data-level="8.3" data-path="spark-pipelines.html"><a href="spark-pipelines.html#reload-model"><i class="fa fa-check"></i><b>8.3</b> Reload model</a></li>
<li class="chapter" data-level="8.4" data-path="spark-pipelines.html"><a href="spark-pipelines.html#reload-pipeline"><i class="fa fa-check"></i><b>8.4</b> Reload pipeline</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="intro-to-dashboards.html"><a href="intro-to-dashboards.html"><i class="fa fa-check"></i><b>9</b> Intro to dashboards</a><ul>
<li class="chapter" data-level="9.1" data-path="intro-to-dashboards.html"><a href="intro-to-dashboards.html#basic-structure"><i class="fa fa-check"></i><b>9.1</b> Basic structure</a></li>
<li class="chapter" data-level="9.2" data-path="intro-to-dashboards.html"><a href="intro-to-dashboards.html#dropdown-data"><i class="fa fa-check"></i><b>9.2</b> Dropdown data</a></li>
<li class="chapter" data-level="9.3" data-path="intro-to-dashboards.html"><a href="intro-to-dashboards.html#update-dashboard-items"><i class="fa fa-check"></i><b>9.3</b> Update dashboard items</a></li>
<li class="chapter" data-level="9.4" data-path="intro-to-dashboards.html"><a href="intro-to-dashboards.html#integrate-the-dropdown"><i class="fa fa-check"></i><b>9.4</b> Integrate the dropdown</a></li>
<li class="chapter" data-level="9.5" data-path="intro-to-dashboards.html"><a href="intro-to-dashboards.html#add-a-tabset-to-the-dashboard"><i class="fa fa-check"></i><b>9.5</b> Add a tabset to the dashboard</a></li>
<li class="chapter" data-level="9.6" data-path="intro-to-dashboards.html"><a href="intro-to-dashboards.html#add-interactivity"><i class="fa fa-check"></i><b>9.6</b> Add interactivity</a></li>
<li class="chapter" data-level="9.7" data-path="intro-to-dashboards.html"><a href="intro-to-dashboards.html#add-title-to-the-new-tab"><i class="fa fa-check"></i><b>9.7</b> Add title to the new tab</a></li>
<li class="chapter" data-level="9.8" data-path="intro-to-dashboards.html"><a href="intro-to-dashboards.html#pool-pakcage"><i class="fa fa-check"></i><b>9.8</b> pool pakcage</a></li>
<li class="chapter" data-level="9.9" data-path="intro-to-dashboards.html"><a href="intro-to-dashboards.html#publish-dashboard"><i class="fa fa-check"></i><b>9.9</b> Publish dashboard</a></li>
<li class="chapter" data-level="9.10" data-path="intro-to-dashboards.html"><a href="intro-to-dashboards.html#schedule-scoring"><i class="fa fa-check"></i><b>9.10</b> Schedule scoring</a></li>
<li class="chapter" data-level="9.11" data-path="intro-to-dashboards.html"><a href="intro-to-dashboards.html#scheduled-pipeline"><i class="fa fa-check"></i><b>9.11</b> Scheduled pipeline</a></li>
<li class="chapter" data-level="9.12" data-path="intro-to-dashboards.html"><a href="intro-to-dashboards.html#scheduled-re-fitting"><i class="fa fa-check"></i><b>9.12</b> Scheduled re-fitting</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="text-mining-with-sparklyr.html"><a href="text-mining-with-sparklyr.html"><i class="fa fa-check"></i><b>10</b> Text mining with sparklyr</a><ul>
<li class="chapter" data-level="10.1" data-path="text-mining-with-sparklyr.html"><a href="text-mining-with-sparklyr.html#data-import"><i class="fa fa-check"></i><b>10.1</b> Data Import</a></li>
<li class="chapter" data-level="10.2" data-path="text-mining-with-sparklyr.html"><a href="text-mining-with-sparklyr.html#tidying-data"><i class="fa fa-check"></i><b>10.2</b> Tidying data</a></li>
<li class="chapter" data-level="10.3" data-path="text-mining-with-sparklyr.html"><a href="text-mining-with-sparklyr.html#transform-the-data"><i class="fa fa-check"></i><b>10.3</b> Transform the data</a></li>
<li class="chapter" data-level="10.4" data-path="text-mining-with-sparklyr.html"><a href="text-mining-with-sparklyr.html#data-exploration"><i class="fa fa-check"></i><b>10.4</b> Data Exploration</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="text-mining-with-sparklyr" class="section level1">
<h1><span class="header-section-number">10</span> Text mining with sparklyr</h1>
<p>For this example, there are two files that will be analyzed. They are both the full works of Sir Arthur Conan Doyle and Mark Twain. The files were downloaded from the <a href="https://www.gutenberg.org/">Gutenberg Project</a> site via the <code>gutenbergr</code> package. Intentionally, no data cleanup was done to the files prior to this analysis. See the appendix below to see how the data was downloaded and prepared.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">readLines</span>(<span class="st">&quot;/usr/share/class/bonus/arthur_doyle.txt&quot;</span>, <span class="dv">30</span>) </code></pre>
<div id="data-import" class="section level2">
<h2><span class="header-section-number">10.1</span> Data Import</h2>
<ol style="list-style-type: decimal">
<li>Open a Spark session</li>
</ol>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(sparklyr)
<span class="kw">library</span>(dplyr)

conf &lt;-<span class="st"> </span><span class="kw">spark_config</span>()
conf<span class="op">$</span><span class="st">`</span><span class="dt">sparklyr.cores.local</span><span class="st">`</span> &lt;-<span class="st"> </span><span class="dv">4</span>
conf<span class="op">$</span><span class="st">`</span><span class="dt">sparklyr.shell.driver-memory</span><span class="st">`</span> &lt;-<span class="st"> &quot;8G&quot;</span>
conf<span class="op">$</span>spark.memory.fraction &lt;-<span class="st"> </span><span class="fl">0.9</span>

sc &lt;-<span class="st"> </span><span class="kw">spark_connect</span>(<span class="dt">master =</span> <span class="st">&quot;local&quot;</span>, <span class="dt">config =</span> conf,<span class="dt">version =</span> <span class="st">&quot;2.0.0&quot;</span>)</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>The <code>spark_read_text()</code> is a new function which works like <code>readLines()</code> but for <code>sparklyr</code>. Use it to read the <em>mark_twain.txt</em> file into Spark.</li>
</ol>
<pre class="sourceCode r"><code class="sourceCode r">twain_path &lt;-<span class="st"> &quot;file:///usr/share/class/bonus/mark_twain.txt&quot;</span>
twain &lt;-<span class="st"> </span><span class="kw">spark_read_text</span>(sc, <span class="st">&quot;twain&quot;</span>, twain_path) </code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Read the <em>arthur_doyle.txt</em> file into Spark</li>
</ol>
<pre class="sourceCode r"><code class="sourceCode r">doyle_path &lt;-<span class="st"> &quot;file:///usr/share/class/bonus/arthur_doyle.txt&quot;</span>
doyle &lt;-<span class="st"> </span><span class="kw">spark_read_text</span>(sc, <span class="st">&quot;doyle&quot;</span>, doyle_path) </code></pre>
</div>
<div id="tidying-data" class="section level2">
<h2><span class="header-section-number">10.2</span> Tidying data</h2>
<ol style="list-style-type: decimal">
<li>Add a identification column to each data set.</li>
</ol>
<pre class="sourceCode r"><code class="sourceCode r">twain_id &lt;-<span class="st"> </span>twain <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">author =</span> <span class="st">&quot;twain&quot;</span>)

doyle_id &lt;-<span class="st"> </span>doyle <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">author =</span> <span class="st">&quot;doyle&quot;</span>)</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Use <code>sdf_bind_rows()</code> to append the two files together</li>
</ol>
<pre class="sourceCode r"><code class="sourceCode r">both &lt;-<span class="st"> </span>doyle_id <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">sdf_bind_rows</span>(twain_id) 

both</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Filter out empty lines</li>
</ol>
<pre class="sourceCode r"><code class="sourceCode r">all_lines &lt;-<span class="st"> </span>both <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="kw">nchar</span>(line) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)</code></pre>
<ol start="4" style="list-style-type: decimal">
<li>Use Hive’s <em>regexp_replace</em> to remove punctuation</li>
</ol>
<pre class="sourceCode r"><code class="sourceCode r">all_lines &lt;-<span class="st"> </span>all_lines <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">line =</span> <span class="kw">regexp_replace</span>(line, <span class="st">&quot;[_</span><span class="ch">\&quot;\&#39;</span><span class="st">():;,.!?</span><span class="ch">\\</span><span class="st">-]&quot;</span>, <span class="st">&quot; &quot;</span>)) 

<span class="kw">head</span>(all_lines)</code></pre>
</div>
<div id="transform-the-data" class="section level2">
<h2><span class="header-section-number">10.3</span> Transform the data</h2>
<ol style="list-style-type: decimal">
<li>Use <code>ft_tokenizer()</code> to separate each word. in the line. It places it in a list column.</li>
</ol>
<pre class="sourceCode r"><code class="sourceCode r">word_list &lt;-<span class="st"> </span>all_lines <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">ft_tokenizer</span>(<span class="dt">input_col =</span> <span class="st">&quot;line&quot;</span>,
               <span class="dt">output_col =</span> <span class="st">&quot;word_list&quot;</span>)

<span class="kw">head</span>(word_list, <span class="dv">4</span>)</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Remove “stop words” with the <code>ft_stop_words_remover()</code> transformer. The list is of stop words Spark uses is available here: <a href="https://github.com/apache/spark/blob/master/mllib/src/main/resources/org/apache/spark/ml/feature/stopwords/english.txt" class="uri">https://github.com/apache/spark/blob/master/mllib/src/main/resources/org/apache/spark/ml/feature/stopwords/english.txt</a></li>
</ol>
<pre class="sourceCode r"><code class="sourceCode r">wo_stop &lt;-<span class="st"> </span>word_list <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ft_stop_words_remover</span>(<span class="dt">input_col =</span> <span class="st">&quot;word_list&quot;</span>,
                        <span class="dt">output_col =</span> <span class="st">&quot;wo_stop_words&quot;</span>)

<span class="kw">head</span>(wo_stop, <span class="dv">4</span>)</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Un-nest the tokens inside <em>wo_stop_words</em> using <code>explode()</code>. This will create a row per word.</li>
</ol>
<pre class="sourceCode r"><code class="sourceCode r">exploded &lt;-<span class="st"> </span>wo_stop <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">word =</span> <span class="kw">explode</span>(wo_stop_words))

<span class="kw">head</span>(exploded)</code></pre>
<ol start="4" style="list-style-type: decimal">
<li>Select the <em>word</em> and <em>author</em> columns, and remove any word with less than 3 characters.</li>
</ol>
<pre class="sourceCode r"><code class="sourceCode r">all_words &lt;-<span class="st"> </span>exploded <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(word, author) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="kw">nchar</span>(word) <span class="op">&gt;</span><span class="st"> </span><span class="dv">2</span>)
  
<span class="kw">head</span>(all_words, <span class="dv">4</span>)</code></pre>
<ol start="5" style="list-style-type: decimal">
<li>Cache the <em>all_words</em> variable using <code>compute()</code></li>
</ol>
<pre class="sourceCode r"><code class="sourceCode r">all_words &lt;-<span class="st"> </span>all_words <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">compute</span>(<span class="st">&quot;all_words&quot;</span>)</code></pre>
</div>
<div id="data-exploration" class="section level2">
<h2><span class="header-section-number">10.4</span> Data Exploration</h2>
<ol style="list-style-type: decimal">
<li>Words used the most by author</li>
</ol>
<pre class="sourceCode r"><code class="sourceCode r">word_count &lt;-<span class="st"> </span>all_words <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(author, word) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">tally</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(n)) 
  
word_count</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Words most used by Twain</li>
</ol>
<pre class="sourceCode r"><code class="sourceCode r">twain_most &lt;-<span class="st"> </span>word_count <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(author <span class="op">==</span><span class="st"> &quot;twain&quot;</span>)

twain_most</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Use <code>wordcloud</code> to visualize the top 50 words used by Twain</li>
</ol>
<pre class="sourceCode r"><code class="sourceCode r">twain_most <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">head</span>(<span class="dv">50</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">collect</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">with</span>(wordcloud<span class="op">::</span><span class="kw">wordcloud</span>(
    word, 
    n,
    <span class="dt">colors =</span> <span class="kw">c</span>(<span class="st">&quot;#999999&quot;</span>, <span class="st">&quot;#E69F00&quot;</span>, <span class="st">&quot;#56B4E9&quot;</span>,<span class="st">&quot;#56B4E9&quot;</span>)))</code></pre>
<ol start="4" style="list-style-type: decimal">
<li>Words most used by Doyle</li>
</ol>
<pre class="sourceCode r"><code class="sourceCode r">doyle_most &lt;-<span class="st"> </span>word_count <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(author <span class="op">==</span><span class="st"> &quot;doyle&quot;</span>)

doyle_most</code></pre>
<ol start="5" style="list-style-type: decimal">
<li>Used <code>wordcloud</code> to visualize the top 50 words used by Doyle that have more than 5 characters</li>
</ol>
<pre class="sourceCode r"><code class="sourceCode r">doyle_most <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="kw">nchar</span>(word) <span class="op">&gt;</span><span class="st"> </span><span class="dv">5</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">head</span>(<span class="dv">50</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">collect</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">with</span>(wordcloud<span class="op">::</span><span class="kw">wordcloud</span>(
    word, 
    n,
    <span class="dt">colors =</span> <span class="kw">c</span>(<span class="st">&quot;#999999&quot;</span>, <span class="st">&quot;#E69F00&quot;</span>, <span class="st">&quot;#56B4E9&quot;</span>,<span class="st">&quot;#56B4E9&quot;</span>)
    ))</code></pre>
<ol start="6" style="list-style-type: decimal">
<li>Use <code>anti_join()</code> to figure out which words are used by Doyle but not Twain. Order the results by number of words.</li>
</ol>
<pre class="sourceCode r"><code class="sourceCode r">doyle_unique &lt;-<span class="st"> </span>doyle_most <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">anti_join</span>(twain_most, <span class="dt">by =</span> <span class="st">&quot;word&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(n)) 

doyle_unique</code></pre>
<ol start="7" style="list-style-type: decimal">
<li>Use <code>wordcloud</code> to visualize top 50 records in the previous step</li>
</ol>
<pre class="sourceCode r"><code class="sourceCode r">doyle_unique <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">head</span>(<span class="dv">50</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">collect</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">with</span>(wordcloud<span class="op">::</span><span class="kw">wordcloud</span>(
    word, 
    n,
    <span class="dt">colors =</span> <span class="kw">c</span>(<span class="st">&quot;#999999&quot;</span>, <span class="st">&quot;#E69F00&quot;</span>, <span class="st">&quot;#56B4E9&quot;</span>,<span class="st">&quot;#56B4E9&quot;</span>)))</code></pre>
<ol start="8" style="list-style-type: decimal">
<li>Find out how many times Twain used the word “sherlock”</li>
</ol>
<pre class="sourceCode r"><code class="sourceCode r">all_words <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(author <span class="op">==</span><span class="st"> &quot;twain&quot;</span>,
         word <span class="op">==</span><span class="st"> &quot;sherlock&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">tally</span>()</code></pre>
<ol start="9" style="list-style-type: decimal">
<li>Against the <code>twain</code> variable, use Hive’s <em>instr</em> and <em>lower</em> to make all ever word lower cap, and then look for “sherlock” in the line</li>
</ol>
<pre class="sourceCode r"><code class="sourceCode r">twain <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">line =</span> <span class="kw">lower</span>(line)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="kw">instr</span>(line, <span class="st">&quot;sherlock&quot;</span>) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">pull</span>(line)</code></pre>
<p>Most of these lines are in a short story by Mark Twain called <a href="https://www.gutenberg.org/files/3180/3180-h/3180-h.htm#link2H_4_0008">A Double Barrelled Detective Story</a>. As per the <a href="https://en.wikipedia.org/wiki/A_Double_Barrelled_Detective_Story">Wikipedia</a> page about this story, this is a satire by Twain on the mystery novel genre, published in 1902.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">spark_disconnect</span>(sc)</code></pre>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="intro-to-dashboards.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection",
"scroll_highlight": true
},
"toolbar": {
"position": "fixed"
},
"search": true
});
});
</script>

</body>

</html>
